<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Gran Rifa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .btn-custom {
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .table-responsive {
      max-height: 500px;
      overflow-y: auto;
    }
    
    .modal-header {
      background: #dc3545;
      color: white;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container">
      <span class="navbar-brand">👨‍💼 Panel de Administración</span>
      <div>
        <a href="/index.html" class="btn btn-outline-light btn-sm">🏠 Inicio</a>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <h2 class="text-center mb-4">Gestión de la Rifa</h2>
    
    <!-- Estadísticas -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5>Total Tickets</h5>
            <h3 class="text-primary" id="totalTickets">100</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5>Vendidos</h5>
            <h3 class="text-success" id="ticketsVendidos">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5>Disponibles</h5>
            <h3 class="text-warning" id="ticketsDisponibles">100</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center">
          <div class="card-body">
            <h5>Recaudado</h5>
            <h3 class="text-info" id="totalRecaudado">Bs. 0</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="row mb-4">
      <div class="col-md-6">
        <button class="btn btn-success w-100 btn-custom" onclick="marcarComoPagado()">
          ✅ Marcar como Pagado
        </button>
      </div>
      <div class="col-md-6">
        <button class="btn btn-danger w-100 btn-custom" data-bs-toggle="modal" data-bs-target="#confirmModal">
          🗑️ Eliminar Tablas
        </button>
      </div>
    </div>

    <!-- Tabla de órdenes -->
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">📋 Órdenes de Compra</h5>
        <button class="btn btn-outline-primary btn-sm" onclick="exportarDatos()">
          📤 Exportar Datos
        </button>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-striped table-hover mb-0">
            <thead class="table-dark sticky-top">
              <tr>
                <th><input type="checkbox" id="selectAll"></th>
                <th>ID</th>
                <th>Teléfono</th>
                <th>Tickets</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="ordersTable">
              <!-- Las órdenes se cargarán aquí dinámicamente -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Confirmación para Eliminar Tablas -->
  <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmModalLabel">⚠️ Confirmar Eliminación</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p class="alert alert-warning">
            <strong>¡ADVERTENCIA!</strong><br>
            Esta acción <strong>ELIMINARÁ TODOS LOS DATOS</strong> de la rifa incluyendo:
          </p>
          <ul>
            <li>Todas las órdenes de compra</li>
            <li>Historial de pagos</li>
            <li>Estadísticas de ventas</li>
            <li>Registro de tickets vendidos</li>
          </ul>
          <p class="text-danger"><strong>Esta acción NO se puede deshacer.</strong></p>
          <div class="mb-3">
            <label for="confirmText" class="form-label">
              Escribe <strong>"ELIMINAR"</strong> para confirmar:
            </label>
            <input type="text" class="form-control" id="confirmText" placeholder="Escribe ELIMINAR aquí">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">❌ Cancelar</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="eliminarTablas()" disabled>
            🗑️ Eliminar Todo
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Datos de ejemplo para demostración
    let orders = [
      { id: 1, phone: '0412-1234567', tickets: [5, 12, 23], amount: 1497, status: 'Pendiente', date: '2024-01-15' },
      { id: 2, phone: '0414-7654321', tickets: [34, 45], amount: 998, status: 'Pagado', date: '2024-01-14' },
      { id: 3, phone: '0426-5558888', tickets: [56], amount: 499, status: 'Pendiente', date: '2024-01-15' }
    ];

    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
      cargarOrdenes();
      actualizarEstadisticas();
      
      // Validación del texto de confirmación
      document.getElementById('confirmText').addEventListener('input', function() {
        const confirmBtn = document.getElementById('confirmDeleteBtn');
        confirmBtn.disabled = this.value !== 'ELIMINAR';
      });
      
      // Seleccionar todos los checkboxes
      document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('#ordersTable input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
      });
    });

    // Cargar órdenes en la tabla
    function cargarOrdenes() {
      const tbody = document.getElementById('ordersTable');
      tbody.innerHTML = '';

      orders.forEach(order => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><input type="checkbox" class="order-checkbox" data-id="${order.id}"></td>
          <td>${order.id}</td>
          <td>${order.phone}</td>
          <td>${order.tickets.join(', ')}</td>
          <td>Bs. ${order.amount}</td>
          <td>
            <span class="badge ${order.status === 'Pagado' ? 'bg-success' : 'bg-warning'}">
              ${order.status}
            </span>
          </td>
          <td>${order.date}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary" onclick="editarOrden(${order.id})">
              ✏️
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="eliminarOrden(${order.id})">
              🗑️
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Actualizar estadísticas
    function actualizarEstadisticas() {
      const vendidos = orders.reduce((total, order) => 
        order.status === 'Pagado' ? total + order.tickets.length : total, 0
      );
      
      document.getElementById('ticketsVendidos').textContent = vendidos;
      document.getElementById('ticketsDisponibles').textContent = 100 - vendidos;
      document.getElementById('totalRecaudado').textContent = 
        'Bs. ' + orders.reduce((total, order) => 
          order.status === 'Pagado' ? total + order.amount : total, 0
        );
    }

    // Marcar órdenes como pagadas
    function marcarComoPagado() {
      const selectedOrders = document.querySelectorAll('#ordersTable input[type="checkbox"]:checked');
      
      if (selectedOrders.length === 0) {
        alert('Por favor selecciona al menos una orden para marcar como pagada.');
        return;
      }

      selectedOrders.forEach(checkbox => {
        const orderId = parseInt(checkbox.dataset.id);
        const order = orders.find(o => o.id === orderId);
        if (order && order.status === 'Pendiente') {
          order.status = 'Pagado';
        }
      });

      cargarOrdenes();
      actualizarEstadisticas();
      alert('Órdenes marcadas como pagadas correctamente.');
    }

    // Eliminar tablas (función principal)
    function eliminarTablas() {
      // Cerrar el modal
      const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
      modal.hide();
      
      // Simular eliminación (en una aplicación real, aquí iría la llamada a la API)
      setTimeout(() => {
        orders = []; // Vaciar el array de órdenes
        cargarOrdenes();
        actualizarEstadisticas();
        
        // Mostrar confirmación
        alert('✅ Todas las tablas han sido eliminadas correctamente.');
        
        // Limpiar el campo de confirmación
        document.getElementById('confirmText').value = '';
      }, 1000);
    }

    // Funciones auxiliares
    function editarOrden(id) {
      alert(`Editar orden ${id} - Funcionalidad en desarrollo`);
    }

    function eliminarOrden(id) {
      if (confirm(`¿Estás seguro de que quieres eliminar la orden ${id}?`)) {
        orders = orders.filter(order => order.id !== id);
        cargarOrdenes();
        actualizarEstadisticas();
        alert('Orden eliminada correctamente.');
      }
    }

    function exportarDatos() {
      alert('Exportando datos... Funcionalidad en desarrollo');
      // En una aplicación real, aquí se generaría un archivo CSV o Excel
    }
  </script>
</body>
</html>